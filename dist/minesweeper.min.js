/*!
 * Library for making Minesweeper clones
 * https://github.com/binaryluke/Minesweeper
 *
 * Copyright 2015, Luke Howard (@binaryluke)
 *
 * Released under the MIT license
 * http://lukehoward.name/project/minesweeper/license
 */
!function(){"use strict";var t={CLOSED:0,OPEN:1},e={NONE:0,EXCLAMATION:1,QUESTION:2},n={PRISTINE:0,IN_PROGRESS:1,LOST:2,WON:3},o=function(n,o,i,s){this.x=n||0,this.y=o||0,this.isMine=i?!0:!1,this.numAdjacentMines=s||0,this.state=t.CLOSED,this.flag=e.NONE},i=function(t){var e;try{e=a(t)}catch(o){e=!1}if(!e)throw new Error("The mine array supplied to Board constructor was not valid");this._state=n.PRISTINE,this._numRows=t.length,this._numCols=t[0].length,this._numMines=l(t,this._numRows,this._numCols),this._grid=r(t,this._numRows,this._numCols)};i.prototype.state=function(){return this._state},i.prototype.numRows=function(){return this._numRows},i.prototype.numCols=function(){return this._numCols},i.prototype.numMines=function(){return this._numMines},i.prototype.grid=function(){return this._grid},i.prototype.cell=function(t,e){return t>=0&&e>=0&&e<this._numRows&&t<this._numCols?this._grid[e][t]:void 0},i.prototype.cycleCellFlag=function(o,i){var s=this.cell(o,i),r=!0;s&&s.state!==t.OPEN&&this._state!==n.WON&&this._state!==n.LOST&&(s.flag===e.NONE?s.flag=e.EXCLAMATION:s.flag===e.EXCLAMATION?s.flag=e.QUESTION:s.flag===e.QUESTION?s.flag=e.NONE:r=!1,r&&this._state===n.PRISTINE&&(this._state=n.IN_PROGRESS),this._updateState())},i.prototype.openCell=function(o,i){var s=this.cell(o,i);s&&s.state===t.CLOSED&&s.flag===e.NONE&&(s.state=t.OPEN,s.isMine||(this._fourWayFloodFill(o-1,i),this._fourWayFloodFill(o+1,i),this._fourWayFloodFill(o,i-1),this._fourWayFloodFill(o,i+1)),this._state===n.PRISTINE&&(this._state=n.IN_PROGRESS),this._updateState())},i.prototype._fourWayFloodFill=function(n,o){var i=this.cell(n,o);i&&!i.isMine&&i.state===t.CLOSED&&i.flag===e.NONE&&(i.state=t.OPEN,0===i.numAdjacentMines&&(this._fourWayFloodFill(n-1,o),this._fourWayFloodFill(n+1,o),this._fourWayFloodFill(n,o-1),this._fourWayFloodFill(n,o+1)))},i.prototype._updateState=function(){var o,i,s,r=!0;for(i=0;i<this._numRows;i++)for(o=0;o<this._numCols;o++)if(s=this.cell(o,i),s.state===t.OPEN){if(s.isMine)return void(this._state=n.LOST)}else s.state===t.CLOSED&&(s.isMine?s.flag!==e.EXCLAMATION&&(r=!1):r=!1);r&&(this._state=n.WON)};var s=function(t){var e,n,o,i,s,r=[];for(t=t||{},o=t.rows||10,i=t.cols||t.rows||10,s=t.mines||parseInt(o*i*.15,10)||0,n=o*i,e=0;n>e;e++)s>e?r.push(1):r.push(0);return r=f(r),r=h(r,i)},r=function(t,e,n){var i,s,r=[];for(s=0;e>s;s++)for(r[s]=[],i=0;n>i;i++)r[s][i]=new o(i,s,1===t[s][i]?!0:!1,u(t,i,s));return r},l=function(t,e,n){var o,i,s=0;for(i=0;e>i;i++)for(o=0;n>o;o++)1===t[i][o]&&s++;return s},u=function(t,e,n){var o,i,s=e+1,r=n+1,l=t[0].length,u=t.length,a=0;for(i=n-1;r>=i;i++)for(o=e-1;s>=o;o++)(i!==n||o!==e)&&i>=0&&o>=0&&u>i&&l>o&&1===t[i][o]&&a++;return a},a=function(t){var e,n,o,i,s=!0;if(t&&t.length)for(o=t.length,i=t[0]?t[0].length:0,0===i&&(s=!1),e=0;o>e;e++)if(t[e].length!==i)s=!1;else for(n=0;i>n;n++)0!==t[e][n]&&1!==t[e][n]&&(s=!1);else s=!1;return s},f=function(t){for(var e,n,o=t.length;o;)n=Math.floor(Math.random()*o--),e=t[o],t[o]=t[n],t[n]=e;return t},h=function(t,e){var n,o=t.length/e,i=[];for(n=0;o>n;n++)i.push(t.splice(0,e));return i};Object.extend||(Object.extend=function(t,e){for(var n in e)t[n]=e[n];return t});var _={Cell:o,CellStateEnum:t,CellFlagEnum:e,Board:i,BoardStateEnum:n,generateMineArray:s};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=_:"function"==typeof define&&define.amd?define([],function(){return _}):window.minesweeper=_}();